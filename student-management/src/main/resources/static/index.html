<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
          background: #f8f9fa;
        }
        .card {
          box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .form-control::placeholder {
          color: #aaa;
        }
        .btn-update {
          margin-left: 10px;
        }
    </style>
</head>
<body class="container py-5">
<h2 class="mb-4 text-center">ðŸŽ“ Student Management System</h2>

<div class="card p-4 mb-4">
    <form id="studentForm">
        <div class="row g-3">
            <div class="col-md-3">
                <input type="number" class="form-control" id="id" placeholder="Student ID" required />
            </div>
            <div class="col-md-3">
                <input type="text" class="form-control" id="name" placeholder="Name" required />
            </div>
            <div class="col-md-3">
                <input type="text" class="form-control" id="course" placeholder="Course" required />
            </div>
            <div class="col-md-3 d-grid">
                <button type="submit" class="btn btn-primary" id="submitBtn">Add Student</button>
            </div>
        </div>
    </form>
</div>

<div class="card p-4">
    <h4 class="mb-3">ðŸ“‹ All Students</h4>
    <ul id="studentList" class="list-group"></ul>
</div>

<script>
    let isEditMode = false;
    let currentEditId = null;

    async function fetchStudents() {
      const res = await fetch('/students');
      const students = await res.json();
      const list = document.getElementById('studentList');
      list.innerHTML = '';

      students.forEach(student => {
        const li = document.createElement('li');
        li.className = "list-group-item d-flex justify-content-between align-items-center";
        li.innerHTML = `
          <div>
            <strong>ID:</strong> ${student.id} |
            <strong>Name:</strong> ${student.name} |
            <strong>Course:</strong> ${student.course}
          </div>
          <div>
            <button class="btn btn-sm btn-warning" onclick="editStudent(${student.id}, '${student.name}', '${student.course}')">Edit</button>
            <button class="btn btn-sm btn-danger ms-2" onclick="deleteStudent(${student.id})">Delete</button>
          </div>
        `;
        list.appendChild(li);
      });
    }

    function editStudent(id, name, course) {
      document.getElementById('id').value = id;
      document.getElementById('name').value = name;
      document.getElementById('course').value = course;
      document.getElementById('submitBtn').innerText = "Update Student";
      isEditMode = true;
      currentEditId = id;
    }

    async function deleteStudent(id) {
      await fetch('/students/' + id, { method: 'DELETE' });
      fetchStudents();
    }

    document.getElementById('studentForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const id = document.getElementById('id').value;
      const name = document.getElementById('name').value;
      const course = document.getElementById('course').value;

      const student = { id: parseInt(id), name, course };

      if (isEditMode) {
        await fetch(`/students/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(student)
        });
        isEditMode = false;
        currentEditId = null;
        document.getElementById('submitBtn').innerText = "Add Student";
      } else {
        await fetch('/students', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(student)
        });
      }

      document.getElementById('studentForm').reset();
      fetchStudents();
    });

    fetchStudents();
</script>
</body>
</html>
